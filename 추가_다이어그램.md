# Panel Insight 프로젝트 - 추가 다이어그램

## 1. 요구사항 분석 다이어그램

### 1.1 기능 요구사항 매트릭스

```mermaid
graph LR
    subgraph "핵심 기능"
        F1[벡터 검색]
        F2[필터링]
        F3[클러스터링]
        F4[비교 분석]
    end
    
    subgraph "보조 기능"
        F5[패널 상세]
        F6[히스토리]
        F7[내보내기]
        F8[시각화]
    end
    
    subgraph "시스템 요구사항"
        R1[성능]
        R2[보안]
        R3[확장성]
        R4[사용성]
    end
    
    F1 --> R1
    F2 --> R1
    F3 --> R1
    F4 --> R1
    
    F1 --> R2
    F2 --> R2
    F5 --> R2
    
    F1 --> R3
    F3 --> R3
    
    F1 --> R4
    F5 --> R4
    F6 --> R4
    
    style F1 fill:#ffd700
    style F2 fill:#ffd700
    style F3 fill:#ffd700
    style F4 fill:#ffd700
    style R1 fill:#c5e1a5
    style R2 fill:#c5e1a5
    style R3 fill:#c5e1a5
    style R4 fill:#c5e1a5
```

### 1.2 사용자 스토리 맵

```mermaid
graph TD
    User[사용자]
    
    subgraph "사용자 목표"
        G1[패널 검색]
        G2[패널 분석]
        G3[데이터 활용]
    end
    
    subgraph "기능"
        G1 --> F1[자연어 검색]
        G1 --> F2[필터 적용]
        G1 --> F3[결과 확인]
        
        G2 --> F4[클러스터 분석]
        G2 --> F5[그룹 비교]
        G2 --> F6[패널 상세]
        
        G3 --> F7[결과 내보내기]
        G3 --> F8[히스토리 확인]
    end
    
    User --> G1
    User --> G2
    User --> G3
    
    style User fill:#e1f5fe
    style G1 fill:#bbdefb
    style G2 fill:#bbdefb
    style G3 fill:#bbdefb
```

## 2. 화면 설계 다이어그램

### 2.1 화면 구성도 (Screen Flow)

```mermaid
flowchart TD
    Start([사용자 접속])
    
    StartPage[StartPage<br/>메인 검색]
    
    subgraph "검색 경로"
        Filter[FilterDrawer<br/>필터 설정]
        Results[ResultsPage<br/>검색 결과]
        PanelDetail[PanelDetailDrawer<br/>패널 상세]
    end
    
    subgraph "분석 경로"
        ClusterLab[ClusterLabPage<br/>클러스터 분석]
        Compare[ComparePage<br/>비교 분석]
        Export[ExportDrawer<br/>내보내기]
    end
    
    subgraph "보조 기능"
        History[PIHistoryDrawer<br/>히스토리]
        Command[PICommandPalette<br/>명령 팔레트]
    end
    
    Start --> StartPage
    StartPage -->|검색| Results
    StartPage -->|필터| Filter
    Filter --> Results
    
    Results -->|패널 클릭| PanelDetail
    Results -->|클러스터 분석| ClusterLab
    Results -->|비교 분석| Compare
    Results -->|내보내기| Export
    
    ClusterLab --> Compare
    Compare --> Export
    
    StartPage -->|Cmd+K| Command
    Results -->|Cmd+H| History
    
    PanelDetail -->|닫기| Results
    ClusterLab -->|뒤로| Results
    Compare -->|뒤로| Results
    
    style StartPage fill:#61dafb
    style Results fill:#bbdefb
    style ClusterLab fill:#c5e1a5
    style Compare fill:#fff3e0
    style PanelDetail fill:#f3e5f5
```

### 2.2 사용자 여정 다이어그램 (User Journey)

```mermaid
journey
    title 패널 검색 및 분석 여정
    section 검색 시작
      메인 페이지 접속: 5: 사용자
      검색어 입력: 4: 사용자
      필터 선택: 3: 사용자
    section 검색 실행
      검색 버튼 클릭: 5: 사용자
      결과 확인: 4: 사용자
      결과 탐색: 4: 사용자
    section 상세 분석
      패널 클릭: 5: 사용자
      상세 정보 확인: 4: 사용자
      클러스터 분석: 3: 사용자
    section 결과 활용
      비교 분석: 4: 사용자
      결과 내보내기: 5: 사용자
      히스토리 저장: 3: 사용자
```

## 3. 데이터 설계 다이어그램 (상세)

### 3.1 데이터 흐름도 (DFD)

```mermaid
flowchart TD
    subgraph "외부 엔티티"
        User[사용자]
    end
    
    subgraph "프로세스"
        P1[검색 요청 처리]
        P2[임베딩 생성]
        P3[벡터 검색]
        P4[필터 적용]
        P5[결과 포맷팅]
    end
    
    subgraph "데이터 저장소"
        D1[(검색어<br/>임베딩)]
        D2[(패널 데이터)]
        D3[(임베딩 벡터)]
        D4[(필터 설정)]
    end
    
    User -->|검색어, 필터| P1
    P1 -->|검색어| P2
    P2 -->|임베딩| D1
    P1 -->|필터| D4
    
    P2 -->|768차원 벡터| P3
    P3 -->|mb_sn 리스트| D2
    P3 -->|유사도 점수| D3
    
    P3 -->|검색 결과| P4
    D4 -->|필터 조건| P4
    D2 -->|패널 정보| P4
    
    P4 -->|필터링된 결과| P5
    P5 -->|JSON 응답| User
    
    style User fill:#e1f5fe
    style P1 fill:#bbdefb
    style P2 fill:#ffd700
    style P3 fill:#c5e1a5
    style P4 fill:#fff3e0
    style P5 fill:#f3e5f5
```

### 3.2 데이터베이스 스키마 상세 (정규화 전/후)

```mermaid
erDiagram
    WELCOME_1ST {
        string mb_sn PK
        string gender
        string birth_year
        string location
        string detail_location
        timestamp created_at
    }
    
    WELCOME_2ND {
        string mb_sn PK "FK"
        jsonb data
        numeric income_personal "data->>income_personal"
        numeric income_household "data->>income_household"
        timestamp created_at
    }
    
    QUICK_ANSWER {
        string mb_sn PK "FK"
        jsonb answers
        int chunk_count "JSONB 키 개수"
        timestamp created_at
    }
    
    PANEL_EMBEDDINGS {
        string mb_sn PK "FK"
        jsonb demographics
        text combined_text
        text labeled_text
        jsonb chunks
        int chunk_count
        jsonb categories
        jsonb all_labels
        vector embedding "768차원"
        timestamp created_at
    }
    
    CLUSTERING_SESSION {
        uuid session_id PK
        string algorithm "kmeans/hdbscan"
        int n_clusters
        jsonb params
        jsonb metrics "Silhouette, CH, DB"
        timestamp created_at
    }
    
    CLUSTERING_RESULTS {
        uuid id PK
        uuid session_id FK
        string panel_id FK
        int cluster_id
        float confidence
        timestamp created_at
    }
    
    WELCOME_1ST ||--o{ WELCOME_2ND : "has"
    WELCOME_1ST ||--o{ QUICK_ANSWER : "has"
    WELCOME_1ST ||--|| PANEL_EMBEDDINGS : "embeds"
    CLUSTERING_SESSION ||--o{ CLUSTERING_RESULTS : "contains"
    PANEL_EMBEDDINGS ||--o{ CLUSTERING_RESULTS : "clustered"
```

## 4. 인터페이스 설계 다이어그램

### 4.1 API 인터페이스 구조

```mermaid
graph TB
    subgraph "Client Layer"
        React[React Client]
        API_Client[API Client<br/>utils.ts]
    end
    
    subgraph "API Gateway"
        FastAPI[FastAPI Router]
        CORS[CORS Middleware]
        Validation[Pydantic Validation]
    end
    
    subgraph "API Endpoints"
        SearchAPI[POST /api/search]
        PanelAPI[GET /api/panels/{id}]
        ClusterAPI[POST /api/clustering/*]
        HealthAPI[GET /health/*]
    end
    
    subgraph "Request/Response"
        Req1[SearchRequest<br/>query, filters, page]
        Res1[SearchResponse<br/>results, total, pages]
        
        Req2[ClusterRequest<br/>panel_ids, algo, params]
        Res2[ClusterResponse<br/>session_id, labels, metrics]
    end
    
    React --> API_Client
    API_Client -->|HTTP/JSON| FastAPI
    FastAPI --> CORS
    CORS --> Validation
    
    Validation --> SearchAPI
    Validation --> PanelAPI
    Validation --> ClusterAPI
    Validation --> HealthAPI
    
    SearchAPI --> Req1
    SearchAPI --> Res1
    
    ClusterAPI --> Req2
    ClusterAPI --> Res2
    
    Res1 --> API_Client
    Res2 --> API_Client
    API_Client --> React
    
    style React fill:#61dafb
    style FastAPI fill:#009688
    style SearchAPI fill:#ffd700
    style Res1 fill:#c5e1a5
```

### 4.2 컴포넌트 간 통신 구조

```mermaid
sequenceDiagram
    participant User
    participant StartPage
    participant FilterDrawer
    participant ResultsPage
    participant API
    
    User->>StartPage: 검색어 입력
    User->>StartPage: 필터 버튼 클릭
    
    StartPage->>FilterDrawer: onFilterOpen()
    FilterDrawer->>User: 필터 선택 UI
    User->>FilterDrawer: 필터 적용
    FilterDrawer->>StartPage: onApply(filters)
    
    StartPage->>ResultsPage: setView('results')
    ResultsPage->>API: POST /api/search<br/>{query, filters}
    API-->>ResultsPage: {results, total, pages}
    ResultsPage->>User: 검색 결과 표시
    
    User->>ResultsPage: 패널 클릭
    ResultsPage->>User: 패널 상세 표시
```

## 5. 프로젝트 일정 및 이슈 관리

### 5.1 추진 일정 (간트 차트)

```mermaid
gantt
    title Panel Insight 프로젝트 일정
    dateFormat  YYYY-MM-DD
    section 기획 및 설계
    프로젝트 개요 정의           :a1, 2024-01-01, 7d
    요구사항 분석               :a2, after a1, 7d
    시스템 아키텍처 설계        :a3, after a2, 7d
    section 개발 1단계
    백엔드 기본 구조 구축        :b1, after a3, 14d
    벡터 검색 시스템 구현        :b2, after b1, 14d
    필터 기능 구현              :b3, after b2, 7d
    section 개발 2단계
    프론트엔드 기본 구조         :c1, after b1, 14d
    검색 UI 구현                :c2, after c1, 14d
    필터 UI 구현                :c3, after c2, 7d
    section 개발 3단계
    클러스터링 기능             :d1, after b3, 21d
    비교 분석 기능              :d2, after d1, 14d
    시각화 기능                 :d3, after d2, 14d
    section 테스트 및 배포
    통합 테스트                 :e1, after d3, 14d
    성능 최적화                 :e2, after e1, 7d
    문서화 및 발표 준비         :e3, after e2, 7d
```

### 5.2 이슈 관리 및 대응 방안

```mermaid
mindmap
  root((이슈 관리))
    기술적 이슈
      pgvector 확장 설치
        해결: Neon DB에서 자동 제공
      임베딩 모델 로딩 속도
        해결: 싱글톤 패턴 적용
      필터 성능 문제
        해결: 2단계 필터링 전략
    데이터 이슈
      스키마 불일치
        해결: 브릿지 뷰 생성
      데이터 타입 변환
        해결: 파싱 로직 구현
    사용자 경험
      검색 결과 지연
        해결: 로딩 상태 표시
      필터 적용 불명확
        해결: 시각적 피드백
    배포 및 운영
      환경 변수 관리
        해결: .env 파일 활용
      CORS 설정
        해결: 미들웨어 구성
```

## 6. 기술 스택 비교 및 선택 근거

### 6.1 기술 스택 비교 매트릭스

```mermaid
graph TB
    subgraph "벡터 검색 솔루션"
        A1[pgvector<br/>PostgreSQL 확장]
        A2[Elasticsearch<br/>Vector Search]
        A3[Pinecone<br/>Managed Service]
    end
    
    subgraph "선택 기준"
        C1[성능]
        C2[비용]
        C3[유지보수]
        C4[통합성]
    end
    
    A1 -->|높음| C1
    A2 -->|높음| C1
    A3 -->|높음| C1
    
    A1 -->|낮음| C2
    A2 -->|중간| C2
    A3 -->|높음| C2
    
    A1 -->|중간| C3
    A2 -->|중간| C3
    A3 -->|낮음| C3
    
    A1 -->|높음| C4
    A2 -->|중간| C4
    A3 -->|낮음| C4
    
    style A1 fill:#c5e1a5
    style C4 fill:#ffd700
```

### 6.2 아키텍처 패턴 선택 근거

```mermaid
graph LR
    subgraph "후보 패턴"
        P1[Monolith]
        P2[Microservices]
        P3[Layered]
        P4[Clean Architecture]
    end
    
    subgraph "요구사항"
        R1[단순한 구조]
        R2[빠른 개발]
        R3[확장 가능성]
        R4[테스트 용이]
    end
    
    P1 -->|단순| R1
    P1 -->|빠름| R2
    P1 -.->|제한적| R3
    
    P2 -.->|복잡| R1
    P2 -.->|느림| R2
    P2 -->|높음| R3
    
    P3 -->|단순| R1
    P3 -->|빠름| R2
    P3 -->|중간| R3
    P3 -->|용이| R4
    
    P4 -.->|복잡| R1
    P4 -.->|느림| R2
    P4 -->|높음| R3
    P4 -->|높음| R4
    
    style P3 fill:#c5e1a5
    style R1 fill:#ffd700
    style R2 fill:#ffd700
```

## 7. 성능 최적화 전략

### 7.1 성능 병목 지점 및 해결 방안

```mermaid
flowchart TD
    subgraph "병목 지점"
        B1[임베딩 생성<br/>~200ms]
        B2[벡터 검색<br/>~100ms]
        B3[필터 적용<br/>~50ms]
        B4[데이터 JOIN<br/>~80ms]
    end
    
    subgraph "최적화 방안"
        O1[모델 싱글톤<br/>+100ms 절감]
        O2[pgvector 인덱스<br/>+50ms 절감]
        O3[2단계 필터링<br/>+30ms 절감]
        O4[배치 JOIN<br/>+20ms 절감]
    end
    
    B1 --> O1
    B2 --> O2
    B3 --> O3
    B4 --> O4
    
    subgraph "예상 성능"
        Before[최적화 전<br/>~430ms]
        After[최적화 후<br/>~230ms]
    end
    
    Before --> After
    
    style B1 fill:#ffcdd2
    style B2 fill:#ffcdd2
    style O1 fill:#c5e1a5
    style O2 fill:#c5e1a5
    style After fill:#81c784
```

## 8. 보안 설계

### 8.1 보안 계층 구조

```mermaid
graph TB
    subgraph "보안 계층"
        L1[네트워크 계층<br/>HTTPS, CORS]
        L2[인증/인가 계층<br/>API Key, JWT]
        L3[데이터 계층<br/>SQL 인젝션 방지]
        L4[애플리케이션 계층<br/>입력 검증]
    end
    
    subgraph "위협"
        T1[무단 접근]
        T2[데이터 변조]
        T3[SQL 인젝션]
        T4[XSS 공격]
    end
    
    L1 -->|방어| T1
    L2 -->|방어| T2
    L3 -->|방어| T3
    L4 -->|방어| T4
    
    style L1 fill:#c5e1a5
    style L2 fill:#c5e1a5
    style L3 fill:#c5e1a5
    style L4 fill:#c5e1a5
```

---

## 다이어그램 활용 가이드

### 보고서 섹션별 다이어그램 매핑

| 보고서 섹션 | 추천 다이어그램 |
|------------|----------------|
| **요구사항 분석** | 1. 기능 요구사항 매트릭스, 1.2 사용자 스토리 맵 |
| **화면설계** | 2.1 화면 구성도, 2.2 사용자 여정 다이어그램 |
| **데이터설계** | 3.1 데이터 흐름도, 3.2 데이터베이스 스키마 상세 |
| **인터페이스 설계** | 4.1 API 인터페이스 구조, 4.2 컴포넌트 간 통신 구조 |
| **추진 일정** | 5.1 추진 일정 (간트 차트) |
| **이슈사항 및 대응방안** | 5.2 이슈 관리 및 대응 방안 |

### 추가 고려사항

1. **시장 분석**: 기술 스택 비교 매트릭스 (6.1) 활용
2. **성능 최적화**: 7.1 성능 병목 지점 다이어그램
3. **보안**: 8.1 보안 계층 구조

